**Проект построен на основе laravel 8. Вебсокет работает на linux**

**Запуск проекта через консоль**:
+ Создать в СУБД MySQL базу *offer-tracker*. Либо использовать дамп БД в */storage*. Учетные данные для подключения к БД в файле *.env.* (При желании можно прописать своего пользователя)

```
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=offer-tracker
DB_USERNAME=admin
DB_PASSWORD=@admin@
```
+ сделать миграцию таблиц, если не использовался дамп.
``php artisan migrate --seed``

+ В файле *.env* в параметре ``TIMEZONE`` прописать номер часового пояса сервера, где запускается проект. В противном случае дата в БД и серверной части кода будет различаться, не будет корректно отображаться статистика офферов и подписок.
+ В файле *.env* в параметре ``WEBSOCKET_PORT``, ``WEBSOCKET_ADDR`` прописать свой порт, если указанный занят.
+ запуск проекта через консоль: ``php artisan serve``
+ если нужно остановить проект полностью, нужно дополнительно выполнить ``pkill -f offer-service`` для остановки вебсокета.


**Приложение SF-AdTech** — трекер трафика, созданный для организации взаимодействия рекламодателей, которые хотят привлечь к себе на сайт посетителей, и веб-мастеров. 

База данных (БД) имеет четыре таблицы для пользователей: пользователи (``users``), роли (``user_roles``), рекламодатели (``advertisers``), веб-мастеры (``webmasters``). Есть три роли пользователя: *рекламодатель*, *веб-мастер*, *администратор*. Можно зарегистирироваться как рекламодатель или веб-мастер, только администратор может создать нового администратора. Таблица рекламодателей и веб-мастеров создана для разделения отношений. БД имеет следующий отношения: таблица офферов ``offers`` -> таблица рекламодателей ``advertisers`` -> таблица пользователей ``users`` и таблица подписок на офферы ``offer_subscriptions`` -> таблица веб-мастеров ``webmasters`` -> таблица пользователей ``users``. Администратор может отключить и удалить учетную запись. В случае удаления удаляются все связанные данные.

Рекламодатель создаёт предложение (*offer*), определяя URL страницы, на которую он хочет приводить людей. В offer-е он указывает стоимость перехода по ссылке. Система определяет комиссию за свои услуги. Вебмастера видят ту долю стоимости оффера, которую получат они. Рекламодатель может включать/выключать и удалять свои офферы. При создании оффера или переключении его статуса, на страницах вебмастеров данные обновляются появляются без перезагрузки. При удалении оффера удаляются все записи о нем (подписки, переходы, из статистики системы и рекламодателя), исчезают с главной страницы и страниц веб-мастеров. При выключении оффер пропадает из страницы веб-мастеров, независимо того, подписаны ли они. При этом в статистике он отображается. Если сервер совершает описанные выше действия, то отправляет эту информацию клиентам (браузерам) через вебсокет. Браузер при получении информации из вебсокета динамически изменит содержание страницы.

Веб-мастера в системе видят активные офферы, подписываются на них, после чего система выдаёт им специальные ссылки, которые они должны разместить в любом виде у себя на ресурсе. Ссылка эта ведёт не на целевой URL, а на систему-редиректор, которая фиксирует переход, а затем перенаправляет клиента на страницу сайта рекламодателя. В рамках работы все доступные реферальные ссылки отображаются на главной странице (если запускать проект через консоль, то http://127.0.0.1:8000/). При запуске проекта через консоль реферальная ссылка имеет вид *http://127.0.0.1:8000/A@B*, где A - id вебмастера, B - id оффера. Посредник ``App\Http\Middleware\IsOfferReference`` проверяет реферальную ссылку на корректность данных. Если такой реферальной ссылки не существует, то редирект на 404 страницу. В противном случае сервер делает запись в таблицу БД ``offer_clicks`` о переходе с указанием времени перехода. На страницах соотвествующего веб-мастера и рекламодателя-создателя оффера обновляется статистика оффера динамически, получив информацию через вебсокет. Факт перехода или ошибочной реферальной ссылки записывается в лог */storage/logs/offer_clicks.log* и обновляет статистику системы (страница администратора) через вебсокет.